<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Form Answer Suggester — Demo</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;max-width:980px;margin:18px auto;padding:18px;}
  header{display:flex;align-items:center;gap:12px}
  h1{margin:0;font-size:20px}
  p.lead{color:#444;margin:6px 0 14px}
  textarea{width:100%;min-height:160px;padding:10px;border:1px solid #ddd;border-radius:8px;resize:vertical;font-family:monospace;}
  .row{display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
  button{padding:8px 12px;border-radius:8px;border:1px solid #2b6; background:#f3f8f3;cursor:pointer}
  .results{margin-top:18px}
  .q{border:1px solid #eee;padding:10px;border-radius:8px;margin-bottom:10px;background:#fbfbfb}
  .q h4{margin:0 0 6px;font-size:15px}
  .choice{font-size:13px;margin-left:8px}
  .conf{font-weight:600;font-size:12px;color:#333;margin-top:6px}
  .explain{font-size:13px;color:#555;margin-top:6px}
  .small{font-size:12px;color:#666}
  .note{background:#fffbe6;padding:8px;border:1px solid #ffe39f;border-radius:6px;margin-bottom:12px}
  footer{margin-top:18px;color:#666;font-size:13px}
  .copybtn{padding:6px 8px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer}
</style>
</head>
<body>
<header>
  <div>
    <h1>Form Answer Suggester — Demo</h1>
    <p class="lead">Paste the Google Form's visible text or the form page's HTML below. The tool will extract questions and suggest likely answers (for study only).</p>
  </div>
</header>

<div class="note">
  <strong>Quick tips:</strong>
  <ul style="margin:6px 0 0 18px">
    <li>Paste the form's visible text (questions + choices) — easiest: open the form, select & copy all, then paste here.</li>
    <li>Alternatively paste the page HTML if you know how (works too).</li>
    <li>Auto-fetching a Google Form URL is not supported offline due to browser restrictions (CORS).</li>
  </ul>
</div>

<label class="small">Paste form text or HTML:</label>
<textarea id="input" placeholder="Paste the form text or HTML here..."></textarea>

<div class="row">
  <button id="extract">Extract & Suggest</button>
  <button id="clear">Clear</button>
  <button id="copyAll" class="copybtn">Copy all suggestions</button>
  <div style="flex:1"></div>
  <label class="small">Confidence legend: <span style="font-weight:600">high</span>/<span style="font-weight:600">medium</span>/<span style="font-weight:600">low</span></label>
</div>

<div id="results" class="results"></div>

<footer>
  <p class="small">This is a study helper — it does <em>not</em> auto-submit answers. Use responsibly and review suggestions.</p>
</footer>

<script>
function extractFromText(text){
  const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l.length>0);
  const blocks = [];
  let cur = [];
  for(let i=0;i<lines.length;i++){
    const L = lines[i];
    if (L.match(/^\d+\.|^Q\.|^Question\b/i) && cur.length>0){
      blocks.push(cur);
      cur = [L];
    } else {
      if ( (L.endsWith('?') || L.match(/^Q\d*[:.]/i) || L.length>60 && cur.length===0) && cur.length>0){
        blocks.push(cur);
        cur = [L];
      } else {
        cur.push(L);
      }
    }
  }
  if (cur.length) blocks.push(cur);
  const questionObjs = [];
  blocks.forEach(b => {
    const joined = b.join('\n');
    const subs = joined.split(/(?=\n?\d+\.)/).map(s=>s.trim()).filter(Boolean);
    const use = subs.length>1 ? subs : [joined];
    use.forEach(u => {
      const ls = u.split(/\n/).map(l=>l.trim()).filter(Boolean);
      let qLine = ls.find(l => l.endsWith('?')) || ls[0];
      const choices = ls.slice(1).filter(l => l.length<200 && (l.match(/^[-•*]\s*/) || l.match(/^[A-Za-z][).]/) || l.split(' ').length < 10));
      if (choices.length===0){
        const maybe = ls.slice(1).filter(l => l.split(' ').length < 10 && l.length<120);
        if (maybe.length) {
          choices.push(...maybe);
        }
      }
      questionObjs.push({question:qLine, raw_lines: ls, choices: choices});
    });
  });
  const unique = [];
  const seen = new Set();
  questionObjs.forEach(q => {
    const key = q.question.slice(0,180);
    if (!seen.has(key)) {
      seen.add(key);
      unique.push(q);
    }
  });
  return unique;
}

function heuristicPredict(q){
  const text = (q.question||'').toLowerCase();
  const words = text.split(/\W+/).filter(w=>w.length>2);
  const freq = {};
  words.forEach(w=>freq[w]=(freq[w]||0)+1);
  const wordList = Object.keys(freq).slice(0,20);

  if (q.choices && q.choices.length>0){
    const scored = q.choices.map(choice => {
      const c = choice.toLowerCase();
      let score = 0;
      wordList.forEach(w=>{ if (c.includes(w)) score += 1; });
      if (c.includes(text.slice(0,10))) score += 0.8;
      if (c.length<=3) score -= 0.6;
      if (text.includes('not') && c.includes('not')) score += 1;
      return {choice: choice, score: score};
    });
    scored.sort((a,b)=>b.score-a.score);
    const best = scored[0];
    const total = scored.reduce((s,it)=>s+Math.max(0,it.score),0);
    let conf = 0;
    if (total<=0) conf = 0.35; else conf = Math.min(0.98, best.score/(total+0.0001));
    const confLabel = conf>0.7 ? 'high' : conf>0.4 ? 'medium' : 'low';
    return {type:'mcq', predicted: best.choice, confidence: confLabel, reasoning: 'Keyword overlaps: '+best.score.toFixed(1)};
  } else {
    const candidate = q.raw_lines && q.raw_lines.length ? q.raw_lines.reduce((a,b)=>a.length>b.length?a:b) : q.question;
    return {type:'short', predicted: candidate, confidence:'low', reasoning:'No explicit choices; suggested from available text.'};
  }
}

function renderSuggestions(qs){
  const out = document.getElementById('results');
  out.innerHTML = '';
  if (!qs || qs.length===0){
    out.innerHTML = '<div class="small">No questions found. Try pasting the entire visible text of the form (select all on the form page, copy & paste).</div>';
    return;
  }
  qs.forEach((q,idx)=>{
    const pred = heuristicPredict(q);
    const div = document.createElement('div'); div.className='q';
    const h = document.createElement('h4'); h.textContent = (idx+1)+'. '+q.question;
    div.appendChild(h);
    if (q.choices && q.choices.length){
      q.choices.forEach(c=>{
        const p = document.createElement('div'); p.className='choice'; p.textContent = '• '+c;
        div.appendChild(p);
      });
    } else {
      const p = document.createElement('div'); p.className='choice'; p.textContent = '(No explicit choices detected)';
      div.appendChild(p);
    }
    const conf = document.createElement('div'); conf.className='conf'; conf.textContent = 'Suggested: '+pred.predicted+' — confidence: '+pred.confidence;
    div.appendChild(conf);
    const ex = document.createElement('div'); ex.className='explain'; ex.textContent = 'Why: '+pred.reasoning;
    div.appendChild(ex);
    out.appendChild(div);
  });
}

document.getElementById('extract').addEventListener('click', ()=>{
  const txt = document.getElementById('input').value;
  if (!txt || txt.trim().length<10){ alert('Paste the form text or HTML first.'); return; }
  const qs = extractFromText(txt);
  renderSuggestions(qs);
});

document.getElementById('clear').addEventListener('click', ()=>{
  document.getElementById('input').value='';
  document.getElementById('results').innerHTML='';
});

document.getElementById('copyAll').addEventListener('click', ()=>{
  const out = document.getElementById('results');
  if (!out.innerText || out.innerText.trim()===''){ alert('No suggestions to copy.'); return; }
  navigator.clipboard.writeText(out.innerText).then(()=>{
    alert('Suggestions copied to clipboard. Review before use.');
  }).catch(()=>{ alert('Copy failed — try selecting the results text and copying manually.'); });
});
</script>
</body>
</html>